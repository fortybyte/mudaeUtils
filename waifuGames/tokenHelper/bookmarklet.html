<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Token Helper - Bookmarklet</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #5865F2;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .bookmarklet-container {
            background: #f0f8ff;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin: 30px 0;
        }
        
        .bookmarklet {
            display: inline-block;
            padding: 12px 24px;
            background: #5865F2;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 18px;
            transition: background-color 0.3s ease;
        }
        
        .bookmarklet:hover {
            background: #4752C4;
        }
        
        .instructions {
            margin-top: 40px;
        }
        
        .instructions h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .instructions ol {
            line-height: 1.8;
            color: #555;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin-top: 30px;
            color: #856404;
        }
        
        .server-config {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        
        .server-config h3 {
            margin-top: 0;
            color: #1976d2;
        }
        
        .server-config input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .server-config button {
            margin-top: 10px;
            padding: 8px 16px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .server-config button:hover {
            background: #1565c0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Discord Token Helper</h1>
        <p class="subtitle">Easily transfer your Discord token to your Bot Manager</p>
        
        <div class="server-config">
            <h3>Server Configuration</h3>
            <p>Enter your Bot Manager server address:</p>
            <input type="text" id="serverUrl" placeholder="e.g., 192.168.1.100:3001" value="localhost:3001">
            <button onclick="updateBookmarklet()">Update Bookmarklet</button>
        </div>
        
        <div class="bookmarklet-container">
            <p>Drag this button to your bookmarks bar:</p>
            <a href="javascript:(function()%7Bconst%20SERVER_HOST%3D'localhost%3A3001'%3Blet%20token%3Dnull%3Btry%7Bconst%20req%3DwebpackChunkdiscord_app.push(%5B%5BMath.random()%5D%2C%7B%7D%2C(req)%3D%3E%7BObject.keys(req.c).map(x%3D%3Ereq.c%5Bx%5D)%7D%5D)%3Bconst%20modules%3DObject.values(req.c)%3Bconst%20tokenModule%3Dmodules.find(m%3D%3Em%3F.exports%3F.default%3F.getToken)%3Bif(tokenModule)%7Btoken%3DtokenModule.exports.default.getToken()%7D%7Dcatch(e)%7B%7Dif(!token)%7Btry%7Btoken%3D(window.localStorage.getItem('token')%7C%7C'').replace(%2F%22%2Fg%2C'')%7Dcatch(e)%7B%7D%7Dif(!token)%7Btry%7Btoken%3D(webpackChunkdiscord_app.push(%5B%5B''%5D%2C%7B%7D%2Ce%3D%3E%7Bm%3D%5B%5D%3Bfor(let%20c%20in%20e.c)m.push(e.c%5Bc%5D)%7D%5D)%2Cm).find(m%3D%3Em%3F.exports%3F.default%3F.getToken!%3D%3Dvoid%200).exports.default.getToken()%7Dcatch(e)%7B%7D%7Dif(!token)%7Bconsole.error('%E2%9D%8C%20Could%20not%20find%20token')%3Breturn%7Dconsole.log('%E2%9C%85%20Token%20found!')%3Bnavigator.clipboard.writeText(token).then(()%3D%3E%7Bconsole.log('%F0%9F%93%8B%20Token%20copied%20to%20clipboard!')%7D)%3Bconst%20div%3Ddocument.createElement('div')%3Bdiv.style.cssText%3D%60position%3A%20fixed%3Btop%3A%2020px%3Bright%3A%2020px%3Bbackground%3A%20%235865F2%3Bcolor%3A%20white%3Bpadding%3A%2020px%3Bborder-radius%3A%208px%3Bfont-family%3A%20-apple-system%2C%20sans-serif%3Bbox-shadow%3A%200%204px%2012px%20rgba(0%2C0%2C0%2C0.3)%3Bz-index%3A%209999%3Bmax-width%3A%20300px%3B%60%3Bdiv.innerHTML%3D%60%3Ch3%20style%3D%22margin%3A%200%200%2010px%200%3B%22%3EToken%20Helper%3C%2Fh3%3E%3Cp%20style%3D%22margin%3A%200%200%2015px%200%3B%20font-size%3A%2014px%3B%22%3EYour%20token%20has%20been%20copied%20to%20clipboard!%3C%2Fp%3E%3Cdiv%20style%3D%22display%3A%20flex%3B%20gap%3A%2010px%3B%22%3E%3Cbutton%20id%3D%22send-to-manager%22%20style%3D%22background%3A%20white%3Bcolor%3A%20%235865F2%3Bborder%3A%20none%3Bpadding%3A%208px%2016px%3Bborder-radius%3A%204px%3Bcursor%3A%20pointer%3Bfont-weight%3A%20500%3B%22%3ESend%20to%20Bot%20Manager%3C%2Fbutton%3E%3Cbutton%20id%3D%22close-helper%22%20style%3D%22background%3A%20transparent%3Bcolor%3A%20white%3Bborder%3A%201px%20solid%20white%3Bpadding%3A%208px%2016px%3Bborder-radius%3A%204px%3Bcursor%3A%20pointer%3B%22%3EClose%3C%2Fbutton%3E%3C%2Fdiv%3E%60%3Bdocument.body.appendChild(div)%3Bdocument.getElementById('close-helper').onclick%3D()%3D%3Ediv.remove()%3Bdocument.getElementById('send-to-manager').onclick%3Dasync()%3D%3E%7Bconst%20button%3Ddocument.getElementById('send-to-manager')%3Bbutton.textContent%3D'Sending...'%3Bbutton.disabled%3Dtrue%3Btry%7Bconst%20authToken%3Dprompt('Enter%20your%20Bot%20Manager%20password%3A')%3Bif(!authToken)%7Bbutton.textContent%3D'Cancelled'%3Breturn%7Dconst%20authResponse%3Dawait%20fetch(%60http%3A%2F%2F%24%7BSERVER_HOST%7D%2Fapi%2Fauth%2Flogin%60%2C%7Bmethod%3A'POST'%2Cheaders%3A%7B'Content-Type'%3A'application%2Fjson'%7D%2Cbody%3AJSON.stringify(%7Bpassword%3AauthToken%7D)%7D)%3Bif(!authResponse.ok)%7Bthrow%20new%20Error('Invalid%20password')%7Dconst%7Btoken%3AsessionToken%7D%3Dawait%20authResponse.json()%3Bconst%20response%3Dawait%20fetch(%60http%3A%2F%2F%24%7BSERVER_HOST%7D%2Fapi%2Ftoken%2Fsubmit%60%2C%7Bmethod%3A'POST'%2Cheaders%3A%7B'Content-Type'%3A'application%2Fjson'%2C'Authorization'%3A%60Bearer%20%24%7BsessionToken%7D%60%7D%2Cbody%3AJSON.stringify(%7Btoken%3Atoken%2Cusername%3Adocument.querySelector('%5Bclass*%3D%22username-%22%5D')%3F.textContent%7C%7C'Unknown%20User'%7D)%7D)%3Bif(response.ok)%7Bbutton.textContent%3D'%E2%9C%93%20Sent!'%3BsetTimeout(()%3D%3Ediv.remove()%2C2000)%7Delse%7Bthrow%20new%20Error('Failed%20to%20send')%7D%7Dcatch(error)%7Bbutton.textContent%3D'%E2%9C%97%20Error'%3Bconsole.error('Failed%20to%20send%20token%3A'%2Cerror)%7D%7D%7D)()" 
                 class="bookmarklet" id="bookmarklet">
                üéØ Token Helper
            </a>
        </div>
        
        <div class="instructions">
            <h2>How to Use</h2>
            <ol>
                <li>Configure your server address above (use your local IP if accessing from another device)</li>
                <li>Drag the "Token Helper" button to your bookmarks bar</li>
                <li>Go to Discord Web (discord.com/app)</li>
                <li>Click the bookmarklet in your bookmarks bar</li>
                <li>A popup will appear with options to copy your token or send it to your Bot Manager</li>
                <li>Enter your Bot Manager password (default: BadApple!)</li>
                <li>The token will appear in your Bot Manager's "Quick Add Tokens" section</li>
            </ol>
        </div>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Security Notice:</strong> Only use this tool with your own Discord accounts. Never share your token with others or use it on untrusted websites.
        </div>
    </div>
    
    <script>
        function updateBookmarklet() {
            const serverUrl = document.getElementById('serverUrl').value;
            const bookmarklet = document.getElementById('bookmarklet');
            
            // The actual script with SERVER_HOST placeholder replaced
            const script = `(function(){const SERVER_HOST='${serverUrl}';let token=null;try{const req=webpackChunkdiscord_app.push([[Math.random()],{},(req)=>{Object.keys(req.c).map(x=>req.c[x])}]);const modules=Object.values(req.c);const tokenModule=modules.find(m=>m?.exports?.default?.getToken);if(tokenModule){token=tokenModule.exports.default.getToken()}}catch(e){}if(!token){try{token=(window.localStorage.getItem('token')||'').replace(/"/g,'')}catch(e){}}if(!token){try{token=(webpackChunkdiscord_app.push([[''],{},e=>{m=[];for(let c in e.c)m.push(e.c[c])}]),m).find(m=>m?.exports?.default?.getToken!==void 0).exports.default.getToken()}catch(e){}}if(!token){console.error('‚ùå Could not find token');return}console.log('‚úÖ Token found!');navigator.clipboard.writeText(token).then(()=>{console.log('üìã Token copied to clipboard!')});const div=document.createElement('div');div.style.cssText=\`position: fixed;top: 20px;right: 20px;background: #5865F2;color: white;padding: 20px;border-radius: 8px;font-family: -apple-system, sans-serif;box-shadow: 0 4px 12px rgba(0,0,0,0.3);z-index: 9999;max-width: 300px;\`;div.innerHTML=\`<h3 style="margin: 0 0 10px 0;">Token Helper</h3><p style="margin: 0 0 15px 0; font-size: 14px;">Your token has been copied to clipboard!</p><div style="display: flex; gap: 10px;"><button id="send-to-manager" style="background: white;color: #5865F2;border: none;padding: 8px 16px;border-radius: 4px;cursor: pointer;font-weight: 500;">Send to Bot Manager</button><button id="close-helper" style="background: transparent;color: white;border: 1px solid white;padding: 8px 16px;border-radius: 4px;cursor: pointer;">Close</button></div>\`;document.body.appendChild(div);document.getElementById('close-helper').onclick=()=>div.remove();document.getElementById('send-to-manager').onclick=async()=>{const button=document.getElementById('send-to-manager');button.textContent='Sending...';button.disabled=true;try{const authToken=prompt('Enter your Bot Manager password:');if(!authToken){button.textContent='Cancelled';return}const authResponse=await fetch(\`http://\${SERVER_HOST}/api/auth/login\`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:authToken})});if(!authResponse.ok){throw new Error('Invalid password')}const{token:sessionToken}=await authResponse.json();const response=await fetch(\`http://\${SERVER_HOST}/api/token/submit\`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':\`Bearer \${sessionToken}\`},body:JSON.stringify({token:token,username:document.querySelector('[class*="username-"]')?.textContent||'Unknown User'})});if(response.ok){button.textContent='‚úì Sent!';setTimeout(()=>div.remove(),2000)}else{throw new Error('Failed to send')}}catch(error){button.textContent='‚úó Error';console.error('Failed to send token:',error)}}})()`;
            
            bookmarklet.href = 'javascript:' + encodeURIComponent(script);
            alert('Bookmarklet updated with server: ' + serverUrl);
        }
        
        // Load saved server URL
        const savedUrl = localStorage.getItem('botManagerServer') || 'localhost:3001';
        document.getElementById('serverUrl').value = savedUrl;
        
        // Save server URL
        document.getElementById('serverUrl').addEventListener('change', (e) => {
            localStorage.setItem('botManagerServer', e.target.value);
        });
    </script>
</body>
</html>